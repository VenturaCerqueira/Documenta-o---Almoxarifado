# 2. ‚Ü©Ô∏èTroca Lota√ß√£o/ Secretaria: Usuario com +1 de um setor:

## ‚úÖ - Objetivo :

### üßëüèª- Solicita√ß√£o usu√°rio:

O sistema deve permitir que os usu√°rios possam solicitar materias para outros setores, independente da sua secretaria  ou lota√ß√£o.

### üíª - Rota/tela:

**‚úÖ -  Altera√ß√£o:**

- http://www.keepinformatica.com/almoxarifado/web/user-management/user/create;
- http://www.keepinformatica.com/almoxarifado/web/user-management/user/update?id=id
- http://www.keepinformatica.com/almoxarifado/web/user-management/user/view?id=id

---

### üìÉ - Descri√ß√£o:

O sistema ser√° atualizado para permitir que os usu√°rios realizem a troca de **"Lota√ß√£o"** e **"Secretaria"**, utilizando as informa√ß√µes previamente cadastradas e atualizadas no perfil de cada usu√°rio. Para facilitar esse processo, ser√° inclu√≠do um bot√£o na parte superior da navega√ß√£o (< Navbar >), que, ao ser clicado, abrir√° uma nova janela modal. Essa modal exibir√° uma lista completa de **"Secretarias"** e **"Lota√ß√µes"**, permitindo a sele√ß√£o direta de op√ß√µes.

Al√©m disso, dois novos campos ser√£o adicionados na se√ß√£o **"Cadastro de Usu√°rio"**, com o objetivo de armazenar informa√ß√µes referentes a secretaria e lota√ß√£o que usuario esta habilitado ao processo de troca:

* Secretarias Secund√°rias: Permite ao administrador selecionar v√°rias op√ß√µes ou marcar "tudo";
* Lota√ß√µes Secund√°rias:  Oferece funcionalidade semelhante, permitindo m√∫ltiplas escolhas ou sele√ß√£o total;

Os novos campos ser√£o denominados **"Secretarias Secund√°rias"** e **"Lota√ß√µes Secund√°rias**, permitindo que o administrador opte por selecionar "tudo" ou realizar escolhas m√∫ltiplas. Esses campos seguir√£o o modelo do campo j√° existente de **"Almoxarifado Administradas"**, garantindo consist√™ncia e facilidade de uso. Adicionando essa nova fun√ß√£o sera necessario cria√ß√£o de alertas informativos dos processos efetuados, sempre alertando que esta em uma "lota√ß√£o" visualizando formas de evitar falhas.

---

### ‚òëÔ∏è - Resumo das altera√ß√µes:

* [X]  Cria√ß√£o no banco  de duas tabelas "secretaria_secundaria" e "lotacao_secundaria";
* [X]  Criar uma modal para altera√ß√£o "lota√ß√£o" e "secretaria";
* [X]  Criar um novo bot√£o na √°rea da < navbar > - "Trocar Lota√ß√£o";
* [X]  Cria√ß√£o de span ou informativo sempre que usuario efetuar uma nova "Requisi√ß√£o";
* [X]  Adicionar titulo em < navbar > qual secretaria/lota√ß√£o encontra-se o usuario;

---

## üíª - Modelagem view - C√≥digo exemplo:

### ‚òëÔ∏è- View alterada:

‚öôÔ∏è - Altera√ß√£o: create + editar

* [X]  Cria√ß√£o dos campos "Secretaria Secundaria" e "Lota√ß√£o Secundaria" abaixo dos campos "secretaria e Lota;

üî¢- C√≥digo exemplo:

```
<div class="col-md-4" id="almoxarife-almoxarifado-div">
                <div class="form-group field-usuario-almoxarife_almoxarifado">
                  <label class="control-label" for="usuario-almoxarife_almoxarifado">Secretaria Secundaria</label>
<span id="parent-s2-togall-usuario-almoxarife_almoxarifado" style="display:none"><span id="s2-togall-usuario-almoxarife_almoxarifado" class="s2-togall-button s2-togall-select"><span class="s2-select-label"><i class="glyphicon glyphicon-unchecked"></i>Selecionar tudo</span><span class="s2-unselect-label"><i class="glyphicon glyphicon-check"></i>Deselecionar tudo</span></span></span><input type="hidden" name="Usuario[almoxarife_almoxarifado]" value=""><select id="usuario-almoxarife_almoxarifado" class="form-control select2-hidden-accessible" name="Usuario[almoxarife_almoxarifado][]" multiple="" size="4" data-krajee-depdrop="depdrop_49de5242" data-s2-options="s2options_9653c55f" data-krajee-select2="select2_ffd6304f" style="width: 1px; height: 1px; visibility: hidden;" data-select2-id="usuario-almoxarife_almoxarifado" tabindex="-1" aria-hidden="true"><option value="78">CENTRAL DE ABASTECIMENTO FARMACEUTICO - CAF</option><option value="79">ALMOXARIFADO CENTRAL</option><option value="80">OBSERVA√á√ÉO - CARRINHO DE EMERG√äNCIA</option><option value="81">TESTE ERGOM√âTRICO - CARRINHO DE EMERG√äNCIA</option><option value="82">ENDOSCOPIA - CARRINHO DE EMERG√äNCIA</option><option value="83">TOMOGRAFIA - CARRINHO DE EMERG√äNCIA</option><option value="84">RESSON√ÇNCIA MAGN√âTICA - CARRINHO DE EMERG√äNCIA</option></select><span class="select2 select2-container select2-container--bootstrap" dir="ltr" data-select2-id="6" style="width: 100%;"><span class="selection"><span class="select2-selection select2-selection--multiple" role="combobox" aria-haspopup="true" aria-expanded="false" tabindex="-1" aria-disabled="false"><ul class="select2-selection__rendered"><li class="select2-search select2-search--inline"><input class="select2-search__field" type="search" tabindex="0" autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false" role="searchbox" aria-autocomplete="list" placeholder="" style="width: 0.75em;"></li></ul></span></span><span class="dropdown-wrapper" aria-hidden="true"></span></span>
```

## ‚òëÔ∏èCria√ß√£o Modal - Span:

Bot√£o **"Trocar Lota√ß√£o"** deve-se localizar na parte superior com a **cor azul** trazendo as op√ß√µes de multiplo select da "Secretaria Secundaria" e "Lota√ß√£o Secundaria", apenas as previamentes cadastradas.

## üé≤ - Modelagem de dados:

### ‚òëÔ∏è - Tabelas Criada:

#### Tabela: user_secretaria_secundaria


| Nome          | Tipo |          |
| ------------- | ---- | -------- |
| id            | int  | not null |
| fk_secretaria | int  | not null |
| fK_user       | int  | not null |

‚öôÔ∏è - Relaciona com tabela secretaria.

#### Tabela: user_lotacao_secundaria


| Nome       | Tipo |          |
| ---------- | ---- | -------- |
| id         | int  | not null |
| fk_lotacao | int  | not null |
| fk_user    | int  | not null |

‚öôÔ∏è- Relaciona com tabela lota√ß√£o.

## ‚öñÔ∏è - Regras:

#### ‚òëÔ∏è- Condicionais:

* [X]  Um usuario pode possui varias "secretaria_secundaria" e "lotacao_secundaria";
* [X]  Ao trocar de secretaria ou lota√ß√£o (sera atualizado a "secretaria" ou "lota√ß√£o" no banco) sera atualizada no campo fk_secretaria e fk_lotacao tornado-se a nova, sempre notificar ao usuario a  sua mudan√ßa com Span;

## ‚òëÔ∏è- Prototipa√ß√£o tela:

![1744827666684](images/2.Altera√ß√£odeLota√ß√µesXSecretarias/1744827666684.png)
