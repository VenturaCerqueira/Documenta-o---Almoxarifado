# 1. Movimenta√ß√£o Geral Novas Regras: ‚öôÔ∏è

## ‚úÖ - Objetivo :

### üßëüèª- Solicita√ß√£o usu√°rio:

O sistema deve permitir que as entradas de notas fiscais possam ser continuada no dia seguinte e alteradas futuramente caso algum erro seja detectado.

---

### üíª - Rota/tela:

**‚úÖ -  Altera√ß√£o (Movimenta√ß√£o Geral):**

- http://www.keepinformatica.com/almoxarifado/web/movimentacao-geral/index;
- http://www.keepinformatica.com/almoxarifado/web/movimentacao-geral/create
- http://www.keepinformatica.com/almoxarifado/web/movimentacao-geral/view?id=id


- ‚öôÔ∏è- **Cria√ß√£o nova tela:**
  - http://www.keepinformatica.com/almoxarifado/web/movimentacao-geral/finalizar?id=id

---

### üìÉ - Descri√ß√£o:

Cria√ß√£o de um nova **situa√ß√£o** em **"Movimenta√ß√£o Geral"** que sera **"Aberto"** tornando possivel usuario salvar movimenta√ß√£o sem necessariamente finalizar, podendo voltar e adicionar novos produtos a nota em outro momento. Juntamente ao novo status sera necessario cria√ß√£o de uma nova tela e um novo bot√£o que ficara disponivel em a√ß√µes que sera "Finalizar" com a funcionalidade de concluir processo da nota tornando status da movimenta√ß√£o em "Realizada".  Outra parte dos ajuste e a cria√ß√£o de novos campos como "valor total da nota" e "diferen√ßa", que servir√£o para afins de calculo evitando erros ao finalizar.

---

### ‚òëÔ∏è - Topicos das altera√ß√µes:

* [X]  Cria√ß√£o de uma nova **Situa√ß√£o** - **"Aberto"** - para indicar que o processo ainda n√£o foi concluida;
* [X]  Nova op√ß√£o em a√ß√µes **"Finalizar"** dentro da view da **"Movimenta√ß√£o Geral"**;
* [X]  Cria√ß√£o de uma nova tela de **finaliza√ß√£o**;

---

## üíª - Modelagem view - C√≥digo exemplo:

### üõ†Ô∏è- View altera√ß√£o:

#### ‚öôÔ∏è- Altera√ß√£o: index

* [X]  Adicionar novo **Status:** Aberto;
* [X]  Criar Bot√£o "Finalizar";

üî¢ - **C√≥digo exemplo cria√ß√£o do bot√£o "Finalizar":**

```
<li><a class="btn-sm" href="/almoxarifado/web/movimentacao-geral/view?id=16699" data-pjax="0">
<i class="glyphicon glyphicon-ok-circle"></i> Finalizar</a></li>

```

üî¢- **C√≥digo exemplo altera√ß√£o status "Aberto":**

```
<td class="text-center" style="width: 15%">
<span class="label label-info">Aberto</span></td>
```

---

#### üõ†Ô∏è- Altera√ß√£o: Create

* [X]  Cria√ß√£o do campo "Total da NF";
* [X]  Ajuste **CSS** dos campos N√∫mero da NF e S√©rie para caber todos os campos na mesma linha, essa altera√ß√£o pode ser diretamente nas class do *bootstrap*, alterando N√∫mero da NF e S√©rie para class *md-2*:<br>

  üî¢ - **C√≥digo exemplo:**

  ```
  class="col-md-2"
  ```

---

#### üõ†Ô∏è - Altera√ß√£o: view

* Cria√ß√£o dos campos "Total da NF" e "Diferen√ßa":

  üî¢ - **C√≥digo exemplo:**

```
<tr><th>Total da Nota</th><td>R$ 542,00</td></tr>
<tr><th>Diferen√ßa Nota</th><td>R$ 0,00</td></tr>
```

### ‚öôÔ∏è- Nova view - Finaliza√ß√£o:

1. [X]  Cria√ß√£o tela responsavel do direcionamento do bot√£o a√ß√µes => "Finalizar", ela sera semelhante a view porem com bot√£o de confirma√ß√£o **"Finalizar movimenta√ß√£o"**.<br>

‚òëÔ∏è- Campos da view "Finaliza√ß√£o":

1. Respons√°vel;
2. Almoxarifado de origem;
3. N√∫mero;
4. Opera√ß√£o;
5. Nota Fiscal;
6. Total da Nota;
7. Diferen√ßa da Nota;
8. Data;
9. Historico;
10. Produto;
11. Lote;
12. Quantidade;
13. Valor Unit√°rio;
14. total;
15. totalizador [quantidade] e [total] dos produtos;
16. bot√£o "Finalizar Movimenta√ß√£o Geral";<br>

    **üñºÔ∏è- Exemplo da cria√ß√£o em imagem:**![1744822676888](images/1.Conferenciaeajustedeemissao/1744822676888.png)

## üé≤ - Modelagem de dados:

### üõ†Ô∏è - Tabelas alteradas:

#### Tabela: nota_fiscal

##### Ser√° necessario adicionar nova coluna em **nota_fiscal**:


| Coluna     | Tipo           |          |
| ---------- | -------------- | -------- |
| total_nota | decimal (10,2) | not null |

## ‚öñÔ∏è - Regras:

#### ‚òëÔ∏è- Condicionais:

* [X]  Apenas havera altera√ß√£o na view e create quando tipo da **"Opera√ß√£o"** for Nota Fiscal (Entrada);
* [X]  Campo "total_nota" sera obrigatorio maior que 0;
* [X]  N√£o sera possivel finalizar caso o valor da  **diferen√ßa** seja maior ou igual a zero (0);

## üî¢ - C√°lculos:

##### üßÆ - Calcular a diferen√ßa:

> Somatorios_item_movimenta√ß√£o =  [quantidade x valor_unitario]

```
diferenca = total_nota - Somatorios_item_movimenta√ß√£o
```

## ‚òëÔ∏è- Prototipa√ß√£o tela:

**üñºÔ∏è - View: Movimenta√ß√£o Geral:**
Route: [http://www.keepinformatica.com/almoxarifado/web/movimentacao-geral/index](https://)

![1744824239554](images/1.Conferenciaeajustedeemissao/1744824239554.png)

**üñºÔ∏è- View: Create/ Criar Movimenta√ß√£o Geral**
Route: [http://www.keepinformatica.com/almoxarifado/web/movimentacao-geral/create](https://)

![1744824397484](images/1.Conferenciaeajustedeemissao/1744824397484.png)

**üñºÔ∏è- View: View das movimenta√ß√µes**

Route: [http://www.keepinformatica.com/almoxarifado/web/movimentacao-geral/view?id=id](https://)

![1744824584840](images/1.Conferenciaeajustedeemissao/1744824584840.png)

üñºÔ∏è- View: Finalizar Movimenta√ß√£o Geral

Route: [[http://www.keepinformatica.com/almoxarifado/web/movimentacao-geral/finalizacao_movimentacao?id=idRoute:](https://)

![1744822676888](images/1.Conferenciaeajustedeemissao/1744822676888.png).!(images/1.Conferenciaeajustedeemissao/1744822676888.png)
