# 4. Parâmetros de Cores Indicativas de Status do Produto 🟢🟡🔴

## ✅ - Objetivo :

### 🧑🏻- Solicitação usuário:

Sinalizar visualmente os itens do estoque com cores (Verde, Amarelo, Vermelho) para indicar a criticidade, priorizando a **proximidade da data de validade** a fim de evitar perdas por vencimento.

---

### 💻 - Rota/tela:

**✅ -  Route**
http://www.keepinformatica.com.br/almoxarifado/web/relatorio/posicao-almoxarifado

---

### 📃 - Descrição:

A lógica atualmente implementada baseia-se na estimativa de quantos dias o estoque disponível pode atender à demanda, com base no consumo médio recente. A partir disso, é adotado um sistema de semáforo que utiliza cores para comunicar, de maneira lúdica e visualmente intuitiva, a situação dos itens no relatório “Posição”.

Serão apresentadas duas formas de análise:

1. Uma baseada na projeção dos dias restantes de estoque (quantidade disponível);
2. Outra considerando o tempo até o vencimento do item (data de validade).

---

### ☑️ - Resumo das alterações:

* [ ]  Criação de um semáforo de validade dos itens 🟢🟡🔴, usando a lógica: Sinalização por Dias de Estoque Restante;

## ⚖️ - Regras:

#### ☑️- Condicionais:

* [ ]  Definir a Cor com Base nos Dias de Estoque Restante:

* Se `Dias_Estoque_Restante` <= 7: **Vermelho** 🔴 (Estoque crítico baixo)
* Se `Dias_Estoque_Restante` > 7 E `Dias_Estoque_Restante` <= 20: **Amarelo** 🟡 (Estoque em atenção)
* Se `Dias_Estoque_Restante` > 20: **Verde** 🟢 (Estoque confortável)

* [ ]  Definir a Cor com Base nos Dias Para Vencer:

* Se `Dias_Para_Vencer` <= 30: **Vermelho** 🔴 (Vencimento muito próximo)
* Se `Dias_Para_Vencer` > 30 E `Dias_Para_Vencer` <= 90: **Amarelo** 🟡 (Vencimento em médio prazo)
* Se `Dias_Para_Vencer` > 90: **Verde** 🟢 (Vencimento distante)
  * *(Nota: Os prazos como 30/90 dias são apenas exemplos e podem ser ajustados).

## 🔢 - Cálculos:

**Passo 1: Calcular o Consumo Médio Diário (últimos 90 dias) já criado no documento 3. Cálculo de estoque Máximo e quantidade**

* **`Data de Referência`**:  Definir como a data atual (data_final => 'Data de Referência') [ RelatorioPosicaoForm.php].
* **`QTD_Total`**: Somar a quantidade total movimentada (saídas/consumo) do produto nos 90 dias anteriores à `Data de Referência`.
  * *Exemplo (Conceitual):*
    ```sql
    SUM(Quantidade)
    WHERE TipoMovimento = 'Saida'
      AND DataMovimento BETWEEN (DataReferencia - 90 dias) AND DataReferencia
    ```
* **`consumo_Medio_Diario`**: `QTD_Total/90`

**Passo 2: Calcular os Dias de Estoque Restante**

* **`Saldo_Total_Atual`**: Obter o saldo de estoque físico atual do produto.
* **`Dias_Estoque_Restante`**: `Saldo_Total_Atual / Consumo_Medio_Diario`
  * *(Nota: Tratar divisão por zero se `Consumo_Medio_Diario` for 0).*

**Passo 3: Definir a Cor com Base nos Dias de Estoque Restante**

* Se `Dias_Estoque_Restante` <= 7: **Vermelho** 🔴 (Estoque crítico baixo)
* Se `Dias_Estoque_Restante` > 7 E `Dias_Estoque_Restante` <= 20: **Amarelo** 🟡 (Estoque em atenção)
* Se `Dias_Estoque_Restante` > 20: **Verde** 🟢 (Estoque confortável)

### 4.3. Proximidade da Validade:

Para atender ao pedido de sinalizar por **proximidade da validade** sera necessário acessar a data de validade registrada nos Lotes:

**Passo 1: Obter a Data de Validade**

* Para cada Lote do produto em estoque, obter a `Data_Validade`. Considerar o lote com a data de validade mais próxima.

**Passo 2: Calcular Dias Para Vencer**

* **`Dias_Para_Vencer`**: `Data_Validade - Data_Atual`

**Passo 3: Definir a Cor com Base nos Dias Para Vencer******

* Se `Dias_Para_Vencer` <= 30: **Vermelho** 🔴 (Vencimento muito próximo)
* Se `Dias_Para_Vencer` > 30 E `Dias_Para_Vencer` <= 90: **Amarelo** 🟡 (Vencimento em médio prazo)
* Se `Dias_Para_Vencer` > 90: **Verde** 🟢 (Vencimento distante)

  * *(Nota: Os prazos como 30/90 dias são apenas exemplos e podem ser ajustados).*

## 4.1 - Parametros Reposição (🔴🟢⚪)

Cor menor que (prazo_reposiacao) = vermelho senão é verde; <br>

Caso Prazo para reposição sejá igual 0 ou null => cor sera igual ⚪ - cinza


| Codgo produto | Descrição | UN. | Lote     | CMD | Saldo | Custo Total | N.Estoque | Prazo Reposição | reposição |
| ------------- | ----------- | --- | -------- | --- | ----- | ----------- | --------- | ----------------- | ----------- |
| 12            | Álcoo      | UND | Sem Lote | --  | --    | ---         | 🔴        | --                |             |
